

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CloudStack Cloud Guide &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/scenario_guides/guide_cloudstack.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Google Cloud Platform Guide" href="guide_gce.html" />
    <link rel="prev" title="Amazon Web Services Guide" href="guide_aws.html" /> <!---- extra head elements for Ansible beyond RTD Sphinx Theme --->
<script type="text/javascript" src="//www.redhat.com/dtm.js"></script>
<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="devel">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> 
</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for Ansible beyond RTD Sphinx Theme --->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

  <div class="DocSite-globalNav ansibleNav">
      <ul>
          <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
          <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
          <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
          <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
          <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
      </ul>
  </div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/logo_invert.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">
    Documentation
  </div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                devel
              </div>
            
          

          <!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <select class="version-list" id="version-list" onchange="javascript:location.href = this.value;">
        <script> x = document.getElementById("version-list"); </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "latest";
            if ( "latest" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","latest");
            } else {
              option.value = current_url.replace("latest","latest");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.8";
            if ( "2.8" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","2.8");
            } else {
              option.value = current_url.replace("latest","2.8");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.7";
            if ( "2.7" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","2.7");
            } else {
              option.value = current_url.replace("latest","2.7");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "devel";
            if ( "devel" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","devel");
            } else {
              option.value = current_url.replace("latest","devel");
            }
            x.add(option);
          </script>
        
      </select>
    </div>
  
</div>
          
<div role="search">
<!--  <form id="rtd-search-form" class="wy-form" action="../search.html" -->
  <form id="rtd-search-form" class="wy-form"  method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/getting_started/index.html">Network Automation Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/user_guide/index.html">Network Automation Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dev_guide/index.html">Network Automation Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules_by_category.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
        
         <!-- extra nav elements for Ansible beyond RTD Sphinx Theme --->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>
      </div>
    </nav>
  </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="cloud_guides.html">Public Cloud Guides</a> &raquo;</li>
        
      <li>CloudStack Cloud Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- Ansible-specific additions for modules etc -->
                
                  <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/scenario_guides/guide_cloudstack.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
                
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <!--- Based on sphinx versionwarning extension. Extension currently only works on READTHEDOCS -->
  <script>
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">');
      para = document.createElement('p');
      banner_text=document.createTextNode("This is a testing site. For the official docs go to https://docs.ansible.com/");
      para.appendChild(banner_text);
      element = document.getElementById('testing_banner_id');
      element.appendChild(para);
      document.write('</div>');
    }

    // Create a banner if we're not the latest version
    current_url = window.location.href;
    if ((current_url.search("latest") > -1) || (current_url.search("/2.9/") > -1)) {
     // no banner for latest release
    } else if (current_url.search("devel") > -1) {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading the *devel* version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    } else {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    }
  </script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cloudstack-cloud-guide">
<h1>CloudStack Cloud Guide<a class="headerlink" href="#cloudstack-cloud-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="cloudstack-introduction"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this section is to explain how to put Ansible modules together to use Ansible in a CloudStack context. You will find more usage examples in the details section of each module.</p>
<p>Ansible contains a number of extra modules for interacting with CloudStack based clouds. All modules support check mode, are designed to be idempotent, have been created and tested, and are maintained by the community.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some of the modules will require domain admin or root admin privileges.</p>
</div>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Prerequisites for using the CloudStack modules are minimal. In addition to Ansible itself, all of the modules require the python library <code class="docutils literal notranslate"><span class="pre">cs</span></code> <a class="reference external" href="https://pypi.org/project/cs/">https://pypi.org/project/cs/</a></p>
<p>You’ll need this Python module installed on the execution host, usually your workstation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install cs
</pre></div>
</div>
<p>Or alternatively starting with Debian 9 and Ubuntu 16.04:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt install python-cs
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">cs also includes a command line interface for ad-hoc interaction with the CloudStack API e.g. <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cs</span> <span class="pre">listVirtualMachines</span> <span class="pre">state=Running</span></code>.</p>
</div>
</div>
<div class="section" id="limitations-and-known-issues">
<h2>Limitations and Known Issues<a class="headerlink" href="#limitations-and-known-issues" title="Permalink to this headline">¶</a></h2>
<p>VPC support has been improved since Ansible 2.3 but is still not yet fully implemented. The community is working on the VPC integration.</p>
</div>
<div class="section" id="credentials-file">
<h2>Credentials File<a class="headerlink" href="#credentials-file" title="Permalink to this headline">¶</a></h2>
<p>You can pass credentials and the endpoint of your cloud as module arguments, however in most cases it is a far less work to store your credentials in the cloudstack.ini file.</p>
<p>The python library cs looks for the credentials file in the following order (last one wins):</p>
<ul class="simple">
<li>A <code class="docutils literal notranslate"><span class="pre">.cloudstack.ini</span></code> (note the dot) file in the home directory.</li>
<li>A <code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_CONFIG</span></code> environment variable pointing to an .ini file.</li>
<li>A <code class="docutils literal notranslate"><span class="pre">cloudstack.ini</span></code> (without the dot) file in the current working directory, same directory as your playbooks are located.</li>
</ul>
<p>The structure of the ini file must look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat <span class="nv">$HOME</span>/.cloudstack.ini
<span class="o">[</span>cloudstack<span class="o">]</span>
<span class="nv">endpoint</span> <span class="o">=</span> https://cloud.example.com/client/api
<span class="nv">key</span> <span class="o">=</span> api key
<span class="nv">secret</span> <span class="o">=</span> api secret
<span class="nv">timeout</span> <span class="o">=</span> <span class="m">30</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The section <code class="docutils literal notranslate"><span class="pre">[cloudstack]</span></code> is the default section. <code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_REGION</span></code> environment variable can be used to define the default section.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.4.</span></p>
</div>
<p>The ENV variables support <code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_*</span></code> as written in the documentation of the library <code class="docutils literal notranslate"><span class="pre">cs</span></code>,  like e.g <code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_TIMEOUT</span></code>, <code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_METHOD</span></code>, etc. has been implemented into Ansible. It is even possible to have some incomplete config in your cloudstack.ini:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat <span class="nv">$HOME</span>/.cloudstack.ini
<span class="o">[</span>cloudstack<span class="o">]</span>
<span class="nv">endpoint</span> <span class="o">=</span> https://cloud.example.com/client/api
<span class="nv">timeout</span> <span class="o">=</span> <span class="m">30</span>
</pre></div>
</div>
<p>and fulfill the missing data by either setting ENV variables or tasks params:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">provision our VMs</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-vm</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure VMs are created and running</span>
      <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">cs_instance</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">api_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">your api key</span>
        <span class="l l-Scalar l-Scalar-Plain">api_secret</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">your api secret</span>
        <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</div>
<div class="section" id="regions">
<h2>Regions<a class="headerlink" href="#regions" title="Permalink to this headline">¶</a></h2>
<p>If you use more than one CloudStack region, you can define as many sections as you want and name them as you like, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat <span class="nv">$HOME</span>/.cloudstack.ini
<span class="o">[</span>exoscale<span class="o">]</span>
<span class="nv">endpoint</span> <span class="o">=</span> https://api.exoscale.ch/compute
<span class="nv">key</span> <span class="o">=</span> api key
<span class="nv">secret</span> <span class="o">=</span> api secret

<span class="o">[</span>example_cloud_one<span class="o">]</span>
<span class="nv">endpoint</span> <span class="o">=</span> https://cloud-one.example.com/client/api
<span class="nv">key</span> <span class="o">=</span> api key
<span class="nv">secret</span> <span class="o">=</span> api secret

<span class="o">[</span>example_cloud_two<span class="o">]</span>
<span class="nv">endpoint</span> <span class="o">=</span> https://cloud-two.example.com/client/api
<span class="nv">key</span> <span class="o">=</span> api key
<span class="nv">secret</span> <span class="o">=</span> api secret
</pre></div>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Sections can also be used to for login into the same region using different accounts.</p>
</div>
<p>By passing the argument <code class="docutils literal notranslate"><span class="pre">api_region</span></code> with the CloudStack modules, the region wanted will be selected.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure my ssh public key exists on Exoscale</span>
  <span class="l l-Scalar l-Scalar-Plain">cs_sshkeypair</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ssh-key</span>
    <span class="l l-Scalar l-Scalar-Plain">public_key</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">&#39;~/.ssh/id_rsa.pub&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">api_region</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">exoscale</span>
  <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
</pre></div>
</div>
<p>Or by looping over a regions list if you want to do the task in every region:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure my ssh public key exists in all CloudStack regions</span>
  <span class="l l-Scalar l-Scalar-Plain">local_action</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cs_sshkeypair</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ssh-key</span>
    <span class="l l-Scalar l-Scalar-Plain">public_key</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">&#39;~/.ssh/id_rsa.pub&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">api_region</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">loop</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">exoscale</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">example_cloud_one</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">example_cloud_two</span>
</pre></div>
</div>
</div>
<div class="section" id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
<p>Since Ansible 2.3 it is possible to use environment variables for domain (<code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_DOMAIN</span></code>), account (<code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_ACCOUNT</span></code>), project (<code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_PROJECT</span></code>), VPC (<code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_VPC</span></code>) and zone (<code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_ZONE</span></code>). This simplifies the tasks by not repeating the arguments for every tasks.</p>
<p>Below you see an example how it can be used in combination with Ansible’s block feature:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-vm</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">block</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure my ssh public key</span>
          <span class="l l-Scalar l-Scalar-Plain">cs_sshkeypair</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ssh-key</span>
            <span class="l l-Scalar l-Scalar-Plain">public_key</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">&#39;~/.ssh/id_rsa.pub&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure my ssh public key</span>
          <span class="l l-Scalar l-Scalar-Plain">cs_instance</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname_short</span><span class="nv"> </span><span class="s">}}&quot;</span>
              <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Linux Debian 7 64-bit 20GB Disk</span>
              <span class="l l-Scalar l-Scalar-Plain">service_offering</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cs_offering</span><span class="nv"> </span><span class="s">}}&quot;</span>
              <span class="l l-Scalar l-Scalar-Plain">ssh_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ssh-key</span>
              <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">running</span>

      <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">CLOUDSTACK_DOMAIN</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">root/customers</span>
        <span class="l l-Scalar l-Scalar-Plain">CLOUDSTACK_PROJECT</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web-app</span>
        <span class="l l-Scalar l-Scalar-Plain">CLOUDSTACK_ZONE</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sf-1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You are still able overwrite the environment variables using the module arguments, e.g. <code class="docutils literal notranslate"><span class="pre">zone:</span> <span class="pre">sf-2</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike <code class="docutils literal notranslate"><span class="pre">CLOUDSTACK_REGION</span></code> these additional environment variables are ignored in the CLI <code class="docutils literal notranslate"><span class="pre">cs</span></code>.</p>
</div>
</div>
<div class="section" id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h2>
<p>The following should give you some ideas how to use the modules to provision VMs to the cloud. As always, there isn’t only one way to do it. But as always: keep it simple for the beginning is always a good start.</p>
<div class="section" id="use-case-provisioning-in-a-advanced-networking-cloudstack-setup">
<h3>Use Case: Provisioning in a Advanced Networking CloudStack setup<a class="headerlink" href="#use-case-provisioning-in-a-advanced-networking-cloudstack-setup" title="Permalink to this headline">¶</a></h3>
<p>Our CloudStack cloud has an advanced networking setup, we would like to provision web servers, which get a static NAT and open firewall ports 80 and 443. Further we provision database servers, to which we do not give any access to. For accessing the VMs by SSH we use a SSH jump host.</p>
<p>This is how our inventory looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[cloud-vm:children]
webserver
db-server
jumphost

[webserver]
web-01.example.com  public_ip=198.51.100.20
web-02.example.com  public_ip=198.51.100.21

[db-server]
db-01.example.com
db-02.example.com

[jumphost]
jump.example.com  public_ip=198.51.100.22
</pre></div>
</div>
<p>As you can see, the public IPs for our web servers and jumphost has been assigned as variable <code class="docutils literal notranslate"><span class="pre">public_ip</span></code> directly in the inventory.</p>
<p>The configure the jumphost, web servers and database servers, we use <code class="docutils literal notranslate"><span class="pre">group_vars</span></code>. The <code class="docutils literal notranslate"><span class="pre">group_vars</span></code> directory contains 4 files for configuration of the groups: cloud-vm, jumphost, webserver and db-server. The cloud-vm is there for specifying the defaults of our cloud infrastructure.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: group_vars/cloud-vm</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">cs_offering</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Small</span>
<span class="l l-Scalar l-Scalar-Plain">cs_firewall</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[]</span>
</pre></div>
</div>
<p>Our database servers should get more CPU and RAM, so we define to use a <code class="docutils literal notranslate"><span class="pre">Large</span></code> offering for them.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: group_vars/db-server</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">cs_offering</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Large</span>
</pre></div>
</div>
<p>The web servers should get a <code class="docutils literal notranslate"><span class="pre">Small</span></code> offering as we would scale them horizontally, which is also our default offering. We also ensure the known web ports are opened for the world.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: group_vars/webserver</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">cs_firewall</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">80</span> <span class="p p-Indicator">}</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">443</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Further we provision a jump host which has only port 22 opened for accessing the VMs from our office IPv4 network.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: group_vars/jumphost</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">cs_firewall</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">22</span><span class="p p-Indicator">,</span> <span class="nv">cidr</span><span class="p p-Indicator">:</span> <span class="s">&quot;17.17.17.0/24&quot;</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Now to the fun part. We create a playbook to create our infrastructure we call it <code class="docutils literal notranslate"><span class="pre">infra.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: infra.yaml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">provision our VMs</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-vm</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">run all enclosed tasks from localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="l l-Scalar l-Scalar-Plain">block</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure VMs are created and running</span>
          <span class="l l-Scalar l-Scalar-Plain">cs_instance</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname_short</span><span class="nv"> </span><span class="s">}}&quot;</span>
            <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Linux Debian 7 64-bit 20GB Disk</span>
            <span class="l l-Scalar l-Scalar-Plain">service_offering</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cs_offering</span><span class="nv"> </span><span class="s">}}&quot;</span>
            <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">running</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure firewall ports opened</span>
          <span class="l l-Scalar l-Scalar-Plain">cs_firewall</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">ip_address</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">public_ip</span><span class="nv"> </span><span class="s">}}&quot;</span>
            <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.port</span><span class="nv"> </span><span class="s">}}&quot;</span>
            <span class="l l-Scalar l-Scalar-Plain">cidr</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.cidr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;0.0.0.0/0&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">loop</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cs_firewall</span><span class="nv"> </span><span class="s">}}&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">public_ip is defined</span>

        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure static NATs</span>
          <span class="l l-Scalar l-Scalar-Plain">cs_staticnat</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vm=&quot;{{ inventory_hostname_short }}&quot; ip_address=&quot;{{ public_ip }}&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">public_ip is defined</span>
</pre></div>
</div>
<p>In the above play we defined 3 tasks and use the group <code class="docutils literal notranslate"><span class="pre">cloud-vm</span></code> as target to handle all VMs in the cloud but instead SSH to these VMs, we use <code class="docutils literal notranslate"><span class="pre">delegate_to:</span> <span class="pre">localhost</span></code> to execute the API calls locally from our workstation.</p>
<p>In the first task, we ensure we have a running VM created with the Debian template. If the VM is already created but stopped, it would just start it. If you like to change the offering on an existing VM, you must add <code class="docutils literal notranslate"><span class="pre">force:</span> <span class="pre">yes</span></code> to the task, which would stop the VM, change the offering and start the VM again.</p>
<p>In the second task we ensure the ports are opened if we give a public IP to the VM.</p>
<p>In the third task we add static NAT to the VMs having a public IP defined.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The public IP addresses must have been acquired in advance, also see <code class="docutils literal notranslate"><span class="pre">cs_ip_address</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For some modules, e.g. <code class="docutils literal notranslate"><span class="pre">cs_sshkeypair</span></code> you usually want this to be executed only once, not for every VM. Therefore you would make a separate play for it targeting localhost. You find an example in the use cases below.</p>
</div>
</div>
<div class="section" id="use-case-provisioning-on-a-basic-networking-cloudstack-setup">
<h3>Use Case: Provisioning on a Basic Networking CloudStack setup<a class="headerlink" href="#use-case-provisioning-on-a-basic-networking-cloudstack-setup" title="Permalink to this headline">¶</a></h3>
<p>A basic networking CloudStack setup is slightly different: Every VM gets a public IP directly assigned and security groups are used for access restriction policy.</p>
<p>This is how our inventory looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[cloud-vm:children]
webserver

[webserver]
web-01.example.com
web-02.example.com
</pre></div>
</div>
<p>The default for your VMs looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: group_vars/cloud-vm</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">cs_offering</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Small</span>
<span class="l l-Scalar l-Scalar-Plain">cs_securitygroups</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span> <span class="s">&#39;default&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Our webserver will also be in security group <code class="docutils literal notranslate"><span class="pre">web</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: group_vars/webserver</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">cs_securitygroups</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span> <span class="s">&#39;default&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;web&#39;</span> <span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The playbook looks like the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: infra.yaml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud base setup</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">upload ssh public key</span>
    <span class="l l-Scalar l-Scalar-Plain">cs_sshkeypair</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">defaultkey</span>
      <span class="l l-Scalar l-Scalar-Plain">public_key</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">&#39;~/.ssh/id_rsa.pub&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure security groups exist</span>
    <span class="l l-Scalar l-Scalar-Plain">cs_securitygroup</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">loop</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">web</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">add inbound SSH to security group default</span>
    <span class="l l-Scalar l-Scalar-Plain">cs_securitygroup_rule</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">security_group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
      <span class="l l-Scalar l-Scalar-Plain">start_port</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">end_port</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">loop</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">22</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">add inbound TCP rules to security group web</span>
    <span class="l l-Scalar l-Scalar-Plain">cs_securitygroup_rule</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">security_group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
      <span class="l l-Scalar l-Scalar-Plain">start_port</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">end_port</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">loop</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">443</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">install VMs in the cloud</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-vm</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">delegate_to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
    <span class="l l-Scalar l-Scalar-Plain">block</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create and run VMs on CloudStack</span>
      <span class="l l-Scalar l-Scalar-Plain">cs_instance</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname_short</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Linux Debian 7 64-bit 20GB Disk</span>
        <span class="l l-Scalar l-Scalar-Plain">service_offering</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cs_offering</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">security_groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cs_securitygroups</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">ssh_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">defaultkey</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Running</span>
      <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vm</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">show VM IP</span>
      <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">msg=&quot;VM {{ inventory_hostname }} {{ vm.default_ip }}&quot;</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">assign IP to the inventory</span>
      <span class="l l-Scalar l-Scalar-Plain">set_fact</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_ssh_host={{ vm.default_ip }}</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">waiting for SSH to come up</span>
      <span class="l l-Scalar l-Scalar-Plain">wait_for</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">port=22 host={{ vm.default_ip }} delay=5</span>
</pre></div>
</div>
<p>In the first play we setup the security groups, in the second play the VMs will created be assigned to these groups. Further you see, that we assign the public IP returned from the modules to the host inventory. This is needed as we do not know the IPs we will get in advance. In a next step you would configure the DNS servers with these IPs for accessing the VMs with their DNS name.</p>
<p>In the last task we wait for SSH to be accessible, so any later play would be able to access the VM by SSH without failure.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="guide_gce.html" class="btn btn-neutral float-right" title="Google Cloud Platform Guide"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="guide_aws.html" class="btn btn-neutral" title="Amazon Web Services Guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Red Hat, Inc.
      <span class="lastupdated">
        Last updated on Aug 10, 2020.
      </span>

    </p>
  </div> 
</footer>
        </div>
      </div>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>

  
  
    
   <!-- extra footer elements for Ansible beyond RTD Sphinx Theme --->
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script> 

</body>
</html>