

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Debugging modules &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/dev_guide/debugging.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Module format and documentation" href="developing_modules_documenting.html" />
    <link rel="prev" title="Ansible and Python 3" href="developing_python_3.html" /> <!---- extra head elements for Ansible beyond RTD Sphinx Theme --->
<script type="text/javascript" src="//www.redhat.com/dtm.js"></script>
<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="devel">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> 
</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for Ansible beyond RTD Sphinx Theme --->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

  <div class="DocSite-globalNav ansibleNav">
      <ul>
          <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
          <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
          <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
          <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
          <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
      </ul>
  </div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/logo_invert.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">
    Documentation
  </div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                devel
              </div>
            
          

          <!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <select class="version-list" id="version-list" onchange="javascript:location.href = this.value;">
        <script> x = document.getElementById("version-list"); </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "latest";
            if ( "latest" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","latest");
            } else {
              option.value = current_url.replace("latest","latest");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.8";
            if ( "2.8" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","2.8");
            } else {
              option.value = current_url.replace("latest","2.8");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.7";
            if ( "2.7" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","2.7");
            } else {
              option.value = current_url.replace("latest","2.7");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "devel";
            if ( "devel" == "devel" ) {
              option.selected = true;
            }
            if (current_url.search("devel") > -1) {
              option.value = current_url.replace("devel","devel");
            } else {
              option.value = current_url.replace("latest","devel");
            }
            x.add(option);
          </script>
        
      </select>
    </div>
  
</div>
          
<div role="search">
<!--  <form id="rtd-search-form" class="wy-form" action="../search.html" -->
  <form id="rtd-search-form" class="wy-form"  method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="developing_locally.html">Adding modules and plugins locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules.html">Should you develop a module?</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules_general.html">Ansible module development: getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules_checklist.html">Contributing your module to Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules_best_practices.html">Conventions, tips, and pitfalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_python_3.html">Ansible and Python 3</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Debugging modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debugging-local">Debugging (local)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-remote">Debugging (remote)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-ansiblemodule-based-modules">Debugging AnsibleModule-based modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules_documenting.html">Module format and documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules_general_windows.html">Windows module development walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules_general_aci.html">Developing Cisco ACI modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="platforms/aws_guidelines.html">Guidelines for Ansible Amazon AWS module development</a></li>
<li class="toctree-l2"><a class="reference internal" href="platforms/openstack_guidelines.html">OpenStack Ansible Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="platforms/ovirt_dev_guide.html">oVirt Ansible Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="platforms/vmware_guidelines.html">Guidelines for VMware module development</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_modules_in_groups.html">Information for submitting a group of modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_lifecycle.html">The lifecycle of an Ansible module</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_plugins.html">Developing plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_inventory.html">Developing dynamic inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_core.html">Developing the Ansible Core Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_program_flow_modules.html">Ansible module architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_api.html">Python API</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_rebasing.html">Rebasing a pull request</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_module_utilities.html">Using and Developing Module Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_collections.html">Developing collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="collections_galaxy_meta.html">Collection Galaxy metadata structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview_architecture.html">Ansible architecture</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/getting_started/index.html">Network Automation Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/user_guide/index.html">Network Automation Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dev_guide/index.html">Network Automation Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules_by_category.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
        
         <!-- extra nav elements for Ansible beyond RTD Sphinx Theme --->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>
      </div>
    </nav>
  </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Debugging modules</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- Ansible-specific additions for modules etc -->
                
                  <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/dev_guide/debugging.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
                
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <!--- Based on sphinx versionwarning extension. Extension currently only works on READTHEDOCS -->
  <script>
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">');
      para = document.createElement('p');
      banner_text=document.createTextNode("This is a testing site. For the official docs go to https://docs.ansible.com/");
      para.appendChild(banner_text);
      element = document.getElementById('testing_banner_id');
      element.appendChild(para);
      document.write('</div>');
    }

    // Create a banner if we're not the latest version
    current_url = window.location.href;
    if ((current_url.search("latest") > -1) || (current_url.search("/2.9/") > -1)) {
     // no banner for latest release
    } else if (current_url.search("devel") > -1) {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading the *devel* version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    } else {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    }
  </script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="debugging-modules">
<span id="debugging"></span><h1>Debugging modules<a class="headerlink" href="#debugging-modules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="debugging-local">
<h2>Debugging (local)<a class="headerlink" href="#debugging-local" title="Permalink to this headline">¶</a></h2>
<p>To break into a module running on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> and step through with the debugger:</p>
<ul class="simple">
<li>Set a breakpoint in the module: <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pdb;</span> <span class="pre">pdb.set_trace()</span></code></li>
<li>Run the module on the local machine: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pdb</span> <span class="pre">./my_new_test_module.py</span> <span class="pre">./args.json</span></code></li>
</ul>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p><cite>echo ‘{“msg”: “hello”}’ | python ./my_new_test_module.py</cite></p>
</div>
</div>
<div class="section" id="debugging-remote">
<h2>Debugging (remote)<a class="headerlink" href="#debugging-remote" title="Permalink to this headline">¶</a></h2>
<p>To debug a module running on a remote target (i.e. not <code class="docutils literal notranslate"><span class="pre">localhost</span></code>):</p>
<ol class="arabic simple">
<li>On your controller machine (running Ansible) set <code class="docutils literal notranslate"><span class="pre">ANSIBLE_KEEP_REMOTE_FILES=1</span></code> to tell Ansible to retain the modules it sends to the remote machine instead of removing them after you playbook runs.</li>
<li>Run your playbook targeting the remote machine and specify <code class="docutils literal notranslate"><span class="pre">-vvvv</span></code> (verbose) to display the remote location Ansible is using for the modules (among many other things).</li>
<li>Take note of the directory Ansible used to store modules on the remote host. This directory is usually under the home directory of your <code class="docutils literal notranslate"><span class="pre">ansible_user</span></code>, in the form <code class="docutils literal notranslate"><span class="pre">~/.ansible/tmp/ansible-tmp-...</span></code>.</li>
<li>SSH into the remote target after the playbook runs.</li>
<li>Navigate to the directory you noted in step 3.</li>
<li>Extract the module you want to debug from the zipped file that Ansible sent to the remote host: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">python</span> <span class="pre">AnsiballZ_my_test_module.py</span> <span class="pre">explode</span></code>. Ansible will expand the module into <code class="docutils literal notranslate"><span class="pre">./debug_dir</span></code>. You can optionally run the zipped file by specifying <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">AnsiballZ_my_test_module.py</span></code>.</li>
<li>Navigate to the debug directory: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">debug_dir</span></code>.</li>
<li>Modify or set a breakpoint in <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code>.</li>
<li>Ensure that the unzipped module is executable: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">chmod</span> <span class="pre">755</span> <span class="pre">__main__.py</span></code>.</li>
<li>Run the unzipped module directly, passing the <code class="docutils literal notranslate"><span class="pre">args</span></code> file that contains the params that were originally passed: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">./__main__.py</span> <span class="pre">args</span></code>. This approach is good for reproducing behavior as well as modifying the parameters for debugging.</li>
</ol>
</div>
<div class="section" id="debugging-ansiblemodule-based-modules">
<span id="id1"></span><h2>Debugging AnsibleModule-based modules<a class="headerlink" href="#debugging-ansiblemodule-based-modules" title="Permalink to this headline">¶</a></h2>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you’re using the <code class="file docutils literal notranslate"><span class="pre">hacking/test-module.py</span></code> script then most of this
is taken care of for you.  If you need to do some debugging of the module
on the remote machine that the module will actually run on or when the
module is used in a playbook then you may need to use this information
instead of relying on <code class="file docutils literal notranslate"><span class="pre">test-module.py</span></code>.</p>
</div>
<p>Starting with Ansible 2.1, AnsibleModule-based modules are put together as
a zip file consisting of the module file and the various python module
boilerplate inside of a wrapper script instead of as a single file with all of
the code concatenated together.  Without some help, this can be harder to
debug as the file needs to be extracted from the wrapper in order to see
what’s actually going on in the module.  Luckily the wrapper script provides
some helper methods to do just that.</p>
<p>If you are using Ansible with the <span class="target" id="index-0"></span><a class="reference internal" href="../reference_appendices/config.html#envvar-ANSIBLE_KEEP_REMOTE_FILES"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">ANSIBLE_KEEP_REMOTE_FILES</span></code></a>
environment variables to keep the remote module file, here’s a sample of how
your debugging session will start:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">ANSIBLE_KEEP_REMOTE_FILES</span><span class="o">=</span><span class="m">1</span> ansible localhost -m ping -a <span class="s1">&#39;data=debugging_session&#39;</span> -vvv
<span class="go">&lt;127.0.0.1&gt; ESTABLISH LOCAL CONNECTION FOR USER: badger</span>
<span class="go">&lt;127.0.0.1&gt; EXEC /bin/sh -c &#39;( umask 77 &amp;&amp; mkdir -p &quot;` echo $HOME/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595 `&quot; &amp;&amp; echo &quot;` echo $HOME/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595 `&quot; )&#39;</span>
<span class="go">&lt;127.0.0.1&gt; PUT /var/tmp/tmpjdbJ1w TO /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping</span>
<span class="go">&lt;127.0.0.1&gt; EXEC /bin/sh -c &#39;LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 /usr/bin/python /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping&#39;</span>
<span class="go">localhost | SUCCESS =&gt; {</span>
<span class="go">    &quot;changed&quot;: false,</span>
<span class="go">    &quot;invocation&quot;: {</span>
<span class="go">        &quot;module_args&quot;: {</span>
<span class="go">            &quot;data&quot;: &quot;debugging_session&quot;</span>
<span class="go">        },</span>
<span class="go">        &quot;module_name&quot;: &quot;ping&quot;</span>
<span class="go">    },</span>
<span class="go">    &quot;ping&quot;: &quot;debugging_session&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Setting <span class="target" id="index-1"></span><a class="reference internal" href="../reference_appendices/config.html#envvar-ANSIBLE_KEEP_REMOTE_FILES"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">ANSIBLE_KEEP_REMOTE_FILES</span></code></a> to <code class="docutils literal notranslate"><span class="pre">1</span></code> tells Ansible to keep the
remote module files instead of deleting them after the module finishes
executing.  Giving Ansible the <code class="docutils literal notranslate"><span class="pre">-vvv</span></code> option makes Ansible more verbose.
That way it prints the file name of the temporary module file for you to see.</p>
<p>If you want to examine the wrapper file you can.  It will show a small python
script with a large, base64 encoded string.  The string contains the module
that is going to be executed.  Run the wrapper’s explode command to turn the
string into some python files that you can work with:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping explode
<span class="go">Module expanded into:</span>
<span class="go">/home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/debug_dir</span>
</pre></div>
</div>
<p>When you look into the debug_dir you’ll see a directory structure like this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">├── ansible_module_ping.py</span>
<span class="l l-Scalar l-Scalar-Plain">├── args</span>
<span class="l l-Scalar l-Scalar-Plain">└── ansible</span>
    <span class="l l-Scalar l-Scalar-Plain">├── __init__.py</span>
    <span class="l l-Scalar l-Scalar-Plain">└── module_utils</span>
        <span class="l l-Scalar l-Scalar-Plain">├── basic.py</span>
        <span class="l l-Scalar l-Scalar-Plain">└── __init__.py</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="file docutils literal notranslate"><span class="pre">ansible_module_ping.py</span></code> is the code for the module itself.  The name
is based on the name of the module with a prefix so that we don’t clash with
any other python module names.  You can modify this code to see what effect
it would have on your module.</li>
<li>The <code class="file docutils literal notranslate"><span class="pre">args</span></code> file contains a JSON string.  The string is a dictionary
containing the module arguments and other variables that Ansible passes into
the module to change its behaviour.  If you want to modify the parameters
that are passed to the module, this is the file to do it in.</li>
<li>The <code class="file docutils literal notranslate"><span class="pre">ansible</span></code> directory contains code from
<a class="reference internal" href="../api/index.html#module-ansible.module_utils" title="ansible.module_utils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ansible.module_utils</span></code></a> that is used by the module.  Ansible includes
files for any <a class="reference internal" href="../api/index.html#module-ansible.module_utils" title="ansible.module_utils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ansible.module_utils</span></code></a> imports in the module but not
any files from any other module.  So if your module uses
<a class="reference internal" href="../api/index.html#module-ansible.module_utils.url" title="ansible.module_utils.url"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ansible.module_utils.url</span></code></a> Ansible will include it for you, but if
your module includes <a class="reference external" href="https://requests.readthedocs.io/en/master/api/">requests</a> then you’ll have to make sure that
the python <a class="reference external" href="https://pypi.org/project/requests/">requests library</a> is installed on the system before running the
module.  You can modify files in this directory if you suspect that the
module is having a problem in some of this boilerplate code rather than in
the module code you have written.</li>
</ul>
<p>Once you edit the code or arguments in the exploded tree you need some way to
run it.  There’s a separate wrapper subcommand for this:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping execute
<span class="go">{&quot;invocation&quot;: {&quot;module_args&quot;: {&quot;data&quot;: &quot;debugging_session&quot;}}, &quot;changed&quot;: false, &quot;ping&quot;: &quot;debugging_session&quot;}</span>
</pre></div>
</div>
<p>This subcommand takes care of setting the PYTHONPATH to use the exploded
<code class="file docutils literal notranslate"><span class="pre">debug_dir/ansible/module_utils</span></code> directory and invoking the script using
the arguments in the <code class="file docutils literal notranslate"><span class="pre">args</span></code> file.  You can continue to run it like this
until you understand the problem.  Then you can copy it back into your real
module file and test that the real module works via <strong class="command">ansible</strong> or
<strong class="command">ansible-playbook</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The wrapper provides one more subcommand, <code class="docutils literal notranslate"><span class="pre">excommunicate</span></code>.  This
subcommand is very similar to <code class="docutils literal notranslate"><span class="pre">execute</span></code> in that it invokes the exploded
module on the arguments in the <code class="file docutils literal notranslate"><span class="pre">args</span></code>.  The way it does this is
different, however.  <code class="docutils literal notranslate"><span class="pre">excommunicate</span></code> imports the <code class="docutils literal notranslate"><span class="pre">main</span></code>
function from the module and then calls that.  This makes excommunicate
execute the module in the wrapper’s process.  This may be useful for
running the module under some graphical debuggers but it is very different
from the way the module is executed by Ansible itself.  Some modules may
not work with <code class="docutils literal notranslate"><span class="pre">excommunicate</span></code> or may behave differently than when used
with Ansible normally.  Those are not bugs in the module; they’re
limitations of <code class="docutils literal notranslate"><span class="pre">excommunicate</span></code>.  Use at your own risk.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="developing_modules_documenting.html" class="btn btn-neutral float-right" title="Module format and documentation"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="developing_python_3.html" class="btn btn-neutral" title="Ansible and Python 3"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Red Hat, Inc.
      <span class="lastupdated">
        Last updated on Aug 10, 2020.
      </span>

    </p>
  </div> 
</footer>
        </div>
      </div>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>

  
  
    
   <!-- extra footer elements for Ansible beyond RTD Sphinx Theme --->
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script> 

</body>
</html>